<!doctype html>
<html class="no-js" lang="en">

<!-- Mirrored from htmldemo.net/koparion/koparion/product-details.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 03 Nov 2025 15:14:51 GMT -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Bookverse - Book Details</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">

    <!-- all css here -->
    <!-- common css import -->
    <div th:replace="common/user/css :: css"></div>
</head>
<body class="product-details">
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->

<!-- Add your site or application content here -->
<!-- header-area-start -->
<div th:replace="common/user/header :: header"></div>
<!-- header-area-end -->
<!-- breadcrumbs-area-start -->
<div class="breadcrumbs-area mb-70">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumbs-menu">
                    <ul>
                        <li><a th:href="@{/}">Home</a></li>
                        <li><a th:href="@{/shop}">Shop</a></li>
                        <li><a href="#" class="active" th:text="${book.title}">product-details</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- breadcrumbs-area-end -->
<!-- product-main-area-start -->
<div class="product-main-area mb-70">
    <div class="container">
        <div class="row">
            <div class="col-lg-9 col-md-12 col-12 order-lg-1 order-1">
                <!-- product-main-area-start -->
                <div class="product-main-area">
                    <div class="row">
                        <div class="col-lg-5 col-md-6 col-12">
                            <div class="flexslider">
                                <ul class="slides">
                                    <!-- Chỉ hiển thị ảnh chính từ imageUrl -->
                                    <li th:if="${book.imageUrl != null && !book.imageUrl.isEmpty()}"
                                        th:attr="data-thumb=${book.imageUrl}">
                                        <img th:src="${book.imageUrl}" th:alt="${book.title}"/>
                                    </li>
                                    <!-- Nếu không có ảnh -->
                                    <li th:if="${book.imageUrl == null || book.imageUrl.isEmpty()}">
                                        <img src="img/placeholder.jpg" th:alt="${book.title}"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-7 col-md-6 col-12">
                            <div class="product-info-main">
                                <div class="page-title">
                                    <h1 th:text="${book.title}">Book Title</h1>
                                </div>
                                <div class="product-info-stock-sku">
                                    <span th:if="${book.stock > 0}">In stock</span>
                                    <span th:if="${book.stock <= 0}" style="color: #d4af37;">Out of stock</span>
                                    <div class="product-attribute">
                                        <span>Author</span>
                                        <span class="value" th:text="${book.author}">Author Name</span>
                                    </div>
                                    <div class="product-attribute">
                                        <span>SKU</span>
                                        <span class="value" th:text="${book.bookId}">SKU</span>
                                    </div>
                                </div>
                                <div class="product-reviews-summary">
                                    <div class="rating-summary">
                                        <a th:each="i : ${#numbers.sequence(1, 5)}" href="#">
                                            <i th:class="${i <= avgRating} ? 'fa fa-star' : 'fa fa-star-o'"></i>
                                        </a>
                                    </div>
                                    <div class="reviews-actions">
                                        <a href="#Reviews"
                                           th:text="${book.reviews != null ? book.reviews.size() : 0} + ' Reviews'">0
                                            Reviews</a>
                                        <a href="#Reviews" class="view">Add Your Review</a>
                                    </div>
                                </div>
                                <div class="product-info-price">
                                    <div class="price-final">
                                        <!-- Nếu có discount -->
                                        <span th:if="${book.discountPercent != null && book.discountPercent > 0}"
                                              th:text="'$' + ${#numbers.formatDecimal(book.discountPrice, 1, 2)}"
                                              style="color:#d4af37;font-weight:bold;">$0.00</span>
                                        <span th:if="${book.discountPercent != null && book.discountPercent > 0}"
                                              class="old-price"
                                              th:text="'$' + ${#numbers.formatDecimal(book.price, 1, 2)}"
                                              style="text-decoration: line-through; color: #888;">$0.00</span>
                                        <!-- Nếu không có discount -->
                                        <span th:if="${book.discountPercent == null || book.discountPercent == 0}"
                                              th:text="'$' + ${#numbers.formatDecimal(book.price, 1, 2)}">$0.00</span>
                                    </div>
                                </div>
                                <div class="product-add-form product-social-links">
                                    <form action="#" th:if="${book.stock > 0}">
                                        <div class="quality-button">
                                            <input class="qty" type="number" value="1" min="1" th:max="${book.stock}" id="product-quantity" style="width: 60px; text-align: center;">
                                        </div>
                                        <a href="#" th:onclick="'addToCart(' + ${book.bookId} + ', document.getElementById(\'product-quantity\').value); return false;'" class="add-to-cart-btn">Add to cart</a>
                                    </form>
                                    <div th:if="${book.stock <= 0}" style="padding: 10px; color: #d4af37;">
                                        <p>This product is currently out of stock.</p>
                                    </div>
                                </div>
                                <div class="product-social-links">
                                    <div class="product-addto-links">
                                        <a href="#" 
                                        th:onclick="'toggleWishlist(' + ${book.bookId} + '); return false;'" 
                                        th:id="'wishlist-btn-' + ${book.bookId}"
                                        class="wishlist-btn"
                                        title="Add to Wishlist">
                                         <i class="fa fa-heart"></i>
                                     </a>
                                    </div>
                                    <div class="product-addto-links-text">
                                        <p th:text="${book.description != null ? book.description : 'No description available.'}">
                                            Description</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- product-main-area-end -->
                <!-- product-info-area-start -->
                <div class="product-info-area mt-80">
                    <!-- Nav tabs -->
                    <ul class="nav">
                        <li><a class="active" href="#Details" data-bs-toggle="tab">Details</a></li>
                        <li><a href="#Reviews" data-bs-toggle="tab"
                               th:text="'Reviews ' + (${book.reviews != null ? book.reviews.size() : 0})">Reviews 0</a>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="Details">
                            <div class="valu">
                                <p th:text="${book.description != null ? book.description : 'No description available.'}">
                                    Description</p>
                                <ul>
                                    <li th:if="${book.author != null}"><i class="fa fa-circle"></i>Author: <span
                                            th:text="${book.author}">Author</span></li>
                                    <li th:if="${book.category != null}"><i class="fa fa-circle"></i>Category: <span
                                            th:text="${book.category.name}">Category</span></li>
                                    <li><i class="fa fa-circle"></i>Price: <span
                                            th:text="'$' + ${#numbers.formatDecimal(book.price, 1, 2)}">$0.00</span>
                                    </li>
                                    <li th:if="${book.discountPercent != null && book.discountPercent > 0}"><i
                                            class="fa fa-circle"></i>Discount: <span
                                            th:text="'-' + ${#numbers.formatDecimal(book.discountPercent, 0, 0)} + '%'">-0%</span>
                                    </li>
                                    <li><i class="fa fa-circle"></i>Stock: <span th:text="${book.stock}">0</span>
                                        available
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="Reviews">
                            <div class="valu valu-2">
                                <div class="section-title mb-60 mt-60">
                                    <h2>Customer Reviews</h2>
                                </div>
                                <ul th:if="${book.reviews != null && !book.reviews.isEmpty()}">
                                    <li th:each="review : ${book.reviews}">
                                        <div class="review-title">
                                            <h3 th:text="${review.user != null ? review.user.username : 'Anonymous'}">
                                                User</h3>
                                        </div>
                                        <div class="review-left">
                                            <div class="review-rating">
                                                <span>Rating</span>
                                                <div class="rating-result">
                                                    <a th:each="i : ${#numbers.sequence(1, 5)}" href="#">
                                                        <i th:class="${i <= review.rating} ? 'fa fa-star' : 'fa fa-star-o'"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="review-right">
                                            <div class="review-content">
                                                <h4 th:text="${review.comment != null ? review.comment : 'No comment'}">
                                                    Comment</h4>
                                            </div>
                                            <div class="review-details">
                                                <p class="review-author">Review by <a href="#"
                                                                                      th:text="${review.user != null ? review.user.username : 'Anonymous'}">User</a>
                                                </p>
                                                <p class="review-date" th:if="${review.createdAt != null}">
                                                    Posted on <span
                                                        th:text="${#temporals.format(review.createdAt, 'MM/dd/yyyy')}">Date</span>
                                                </p>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <p th:if="${book.reviews == null || book.reviews.isEmpty()}" style="padding: 20px;">No
                                    reviews yet. Be the first to review this book!</p>
                                <div class="review-add">
                                    <h3>You're reviewing:</h3>
                                    <h4 th:text="${book.title}">Book Title</h4>
                                </div>
                                <div class="review-field-ratings">
                                    <span>Your Rating <sup>*</sup></span>
                                    <div class="control">
                                        <div class="single-control">
                                            <span>Value</span>
                                            <div class="review-control-vote">
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                            </div>
                                        </div>
                                        <div class="single-control">
                                            <span>Quality</span>
                                            <div class="review-control-vote">
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                            </div>
                                        </div>
                                        <div class="single-control">
                                            <span>Price</span>
                                            <div class="review-control-vote">
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                                <a href="#"><i class="fa fa-star"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="review-form">
                                    <div class="single-form">
                                        <label>Nickname <sup>*</sup></label>
                                        <form action="#">
                                            <input type="text"/>
                                        </form>
                                    </div>
                                    <div class="single-form single-form-2">
                                        <label>Summary <sup>*</sup></label>
                                        <form action="#">
                                            <input type="text"/>
                                        </form>
                                    </div>
                                    <div class="single-form">
                                        <label>Review <sup>*</sup></label>
                                        <form action="#">
                                            <textarea name="massage" cols="10" rows="4"></textarea>
                                        </form>
                                    </div>
                                </div>
                                <div class="review-form-button">
                                    <a href="#">Submit Review</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- product-info-area-end -->
                <!-- new-book-area-start -->

                <!-- new-book-area-start -->
            </div>
            <div class="col-lg-3 col-md-12 col-12 order-lg-2 order-2">
                <div class="shop-left">
                    <div class="left-title mb-20">
                        <h4>Related Books</h4>
                    </div>
                    <div class="random-area mb-30" th:if="${relatedBooks != null && !relatedBooks.isEmpty()}">
                        <div class="product-active-2 owl-carousel">
                            <div class="product-total-2">
                                <div th:each="relatedBook, iterStat : ${relatedBooks}"
                                     th:class="${iterStat.last} ? 'single-most-product' : 'single-most-product bd mb-18'">
                                    <div class="most-product-img">
                                        <a th:href="@{/shop/product/{id}(id=${relatedBook.bookId})}">
                                            <img th:src="${relatedBook.imageUrl}" th:alt="${relatedBook.title}"/>
                                        </a>
                                    </div>
                                    <div class="most-product-content">
                                        <div class="product-rating">
                                            <ul>
                                                <li th:each="i : ${#numbers.sequence(1, 5)}">
                                                    <a href="#"><i class="fa fa-star"></i></a>
                                                </li>
                                            </ul>
                                        </div>
                                        <h4><a th:href="@{/shop/product/{id}(id=${relatedBook.bookId})}"
                                               th:text="${relatedBook.title}">Book Title</a></h4>
                                        <div class="product-price">
                                            <ul>
                                                <!-- Nếu có discount -->
                                                <li th:if="${relatedBook.discountPercent != null && relatedBook.discountPercent > 0}"
                                                    class="old-price"
                                                    style="text-decoration: line-through; color: #888;"
                                                    th:text="'$' + ${#numbers.formatDecimal(relatedBook.price, 1, 2)}">
                                                    $0.00
                                                </li>
                                                <li th:if="${relatedBook.discountPercent != null && relatedBook.discountPercent > 0}"
                                                    th:text="'$' + ${#numbers.formatDecimal(relatedBook.discountPrice, 1, 2)}"
                                                    style="color:#d4af37;font-weight:bold;">
                                                    $0.00
                                                </li>
                                                <!-- Nếu không có discount -->
                                                <li th:if="${relatedBook.discountPercent == null || relatedBook.discountPercent == 0}"
                                                    th:text="'$' + ${#numbers.formatDecimal(relatedBook.price, 1, 2)}">
                                                    $0.00
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="banner-area mb-30">
                        <div class="banner-img-2">
                            <a href="#"><img th:src="@{/user/img/banner/8.jpg}" alt="banner"/></a>
                        </div>
                    </div>
                    <div class="left-title-2">
                        <h2>My Wish List</h2>
                        <div class="random-area mb-30" th:if="${wishlistBooksGroups != null && !wishlistBooksGroups.isEmpty()}">
                            <div class="product-active-2 owl-carousel">
                                <!-- Mỗi nhóm 3 items là một slide -->
                                <div th:each="bookGroup, groupIter : ${wishlistBooksGroups}" class="product-total-2">
                                    <div th:each="book, bookIter : ${bookGroup}"
                                         th:class="${bookIter.last} ? 'single-most-product' : 'single-most-product bd mb-18'">
                                        <div class="most-product-img">
                                            <a th:href="@{/shop/product/{id}(id=${book.bookId})}">
                                                <img th:src="${book.imageUrl != null ? book.imageUrl : '/user/img/product/1.jpg'}"
                                                     th:alt="${book.title}" alt="book"/>
                                            </a>
                                        </div>
                                        <div class="most-product-content">
                                            <div class="product-rating">
                                                <ul>
                                                    <li th:each="k : ${#numbers.sequence(1, 5)}">
                                                        <a href="#">
                                                            <i th:classappend="${k <= 4 ? 'fa fa-star' : 'fa fa-star-o'}"></i>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <h4><a th:href="@{/shop/product/{id}(id=${book.bookId})}"
                                                   th:text="${book.title}">Book Title</a></h4>
                                            <div class="product-price">
                                                <ul>
                                                    <li th:if="${book.discountPercent != null && book.discountPercent > 0}"
                                                        class="old-price"
                                                        style="text-decoration: line-through; color: #888;"
                                                        th:text="'$' + ${#numbers.formatDecimal(book.price, 1, 2)}">
                                                        $0.00
                                                    </li>
                                                    <li th:if="${book.discountPercent != null && book.discountPercent > 0}"
                                                        th:text="'$' + ${#numbers.formatDecimal(book.discountPrice, 1, 2)}"
                                                        style="color:#d4af37;font-weight:bold;">
                                                        $0.00
                                                    </li>
                                                    <li th:if="${book.discountPercent == null || book.discountPercent == 0}"
                                                        th:text="'$' + ${#numbers.formatDecimal(book.price, 1, 2)}">
                                                        $0.00
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p th:if="${wishlistBooksGroups == null || wishlistBooksGroups.isEmpty()}">You have no items in your wish list.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- product-main-area-end -->
<!-- footer-area-start -->
<div th:replace="common/user/footer :: footer"></div>
<!-- footer-area-end -->


<!-- all js here -->
<!-- jquery latest version -->
<div th:replace="common/user/js :: js"></div>
<script th:inline="javascript">
    // Wishlist functionality
    function toggleWishlist(bookId) {
        fetch('/wishlist/toggle', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            credentials: 'same-origin', // Include cookies for session
            body: 'bookId=' + bookId
        })
        .then(response => {
            // Check if response is ok (200-299)
            if (!response.ok) {
                // If 403 or 401, redirect to login
                if (response.status === 403 || response.status === 401) {
                    if (confirm('You need to login to add items to wishlist. Would you like to go to login page?')) {
                        window.location.href = '/login';
                    }
                    return null;
                }
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (!data) return; // User was redirected
            
            if (data.redirect) {
                window.location.href = data.redirect;
                return;
            }
            
            if (data.success) {
                // Update wishlist button state
                const btn = document.getElementById('wishlist-btn-' + bookId);
                if (btn) {
                    const icon = btn.querySelector('i');
                    if (data.inWishlist) {
                        btn.classList.add('in-wishlist');
                        if (icon) {
                            icon.classList.remove('fa-heart-o');
                            icon.classList.add('fa-heart');
                        }
                        btn.style.color = '#d4af37';
                        btn.title = 'Remove from Wishlist';
                    } else {
                        btn.classList.remove('in-wishlist');
                        if (icon) {
                            icon.classList.remove('fa-heart');
                            icon.classList.add('fa-heart-o');
                        }
                        btn.style.color = '';
                        btn.title = 'Add to Wishlist';
                    }
                }
                
                // Show message
                alert(data.message);
            } else {
                alert(data.message || 'Failed to update wishlist');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    }
    
    // Check wishlist status on page load
    document.addEventListener('DOMContentLoaded', function() {
        const bookId = /*[[${book.bookId}]]*/ null;
        if (bookId) {
            fetch('/wishlist/check?bookId=' + bookId, {
                credentials: 'same-origin' // Include cookies for session
            })
                .then(response => {
                    if (!response.ok) {
                        // If 403 or 401, user is not logged in, skip
                        return null;
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.inWishlist) {
                        const btn = document.getElementById('wishlist-btn-' + bookId);
                        if (btn) {
                            btn.classList.add('in-wishlist');
                            const icon = btn.querySelector('i');
                            if (icon) {
                                icon.classList.remove('fa-heart-o');
                                icon.classList.add('fa-heart');
                            }
                            btn.style.color = '#d4af37';
                            btn.title = 'Remove from Wishlist';
                        }
                    }
                })
                .catch(error => {
                    // Silently fail - user might not be logged in
                    console.log('Wishlist check skipped (user might not be logged in)');
                });
        }
    });
</script>
<style>
    .wishlist-btn.in-wishlist {
        color: #d4af37 !important;
    }
    .wishlist-btn:hover {
        color: #d4af37 !important;
    }
</style>
</body>

<!-- Mirrored from htmldemo.net/koparion/koparion/product-details.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 03 Nov 2025 15:14:52 GMT -->
</html>
