<!doctype html>
<html class="no-js" lang="en">

<!-- Mirrored from htmldemo.net/koparion/koparion/cart.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 03 Nov 2025 15:14:38 GMT -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Koparion – Book Shop HTML5 Template</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">

    <!-- common css import -->
    <div th:replace="common/user/css :: css"></div>
</head>
<body class="cart">
<!--[if lt IE 8]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade
    your browser</a> to improve your experience.</p>
<![endif]-->

<!-- Add your site or application content here -->
<!-- header-area-start -->
<div th:replace="common/user/header :: header"></div>
<!-- header-area-end -->
<!-- breadcrumbs-area-start -->
<div class="breadcrumbs-area mb-70">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumbs-menu">
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/cart" class="active">Cart</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- breadcrumbs-area-end -->
<!-- entry-header-area-start -->
<div class="entry-header-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="entry-header-title">
                    <h2>Cart</h2>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- entry-header-area-end -->
<!-- cart-main-area-start -->
<div class="cart-main-area mb-70">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!-- Empty cart message -->
                <div th:if="${cartItems == null || cartItems.isEmpty()}" class="empty-cart-message" style="text-align: center; padding: 60px 20px;">
                    <h2>Your cart is empty</h2>
                    <p>Looks like you haven't added any items to your cart yet.</p>
                    <a th:href="@{/shop}" class="btn" style="margin-top: 20px; display: inline-block; padding: 10px 30px; background: #333; color: #fff; text-decoration: none;">Continue Shopping</a>
                </div>
                
                <!-- Cart items table -->
                <form th:if="${cartItems != null && !cartItems.isEmpty()}" id="cart-form">
                    <div class="table-content table-responsive mb-15 border-1">
                        <table>
                            <thead>
                            <tr>
                                <th class="product-thumbnail">Image</th>
                                <th class="product-name">Product</th>
                                <th class="product-price">Price</th>
                                <th class="product-quantity">Quantity</th>
                                <th class="product-subtotal">Total</th>
                                <th class="product-remove">Remove</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="item : ${cartItems}">
                                <td class="product-thumbnail">
                                    <a th:href="@{/shop/product/{id}(id=${item.book.bookId})}">
                                        <img th:src="${item.book.imageUrl != null ? item.book.imageUrl : '/user/img/product/1.jpg'}" 
                                             th:alt="${item.book.title}" alt="book"/>
                                    </a>
                                </td>
                                <td class="product-name">
                                    <a th:href="@{/shop/product/{id}(id=${item.book.bookId})}" th:text="${item.book.title}">Book Title</a>
                                </td>
                                <td class="product-price">
                                    <span class="amount" th:text="|$${#numbers.formatDecimal(item.book.discountPrice != null ? item.book.discountPrice : item.book.price, 1, 2)}|">$0.00</span>
                                    <span th:if="${item.book.discountPercent != null && item.book.discountPercent > 0}" 
                                          class="original-price" 
                                          style="text-decoration: line-through; color: #999; font-size: 0.9em; display: block; margin-top: 5px;"
                                          th:text="|$${#numbers.formatDecimal(item.book.price, 1, 2)}|">$0.00</span>
                                </td>
                                <td class="product-quantity">
                                    <input type="number" 
                                           th:value="${item.quantity}" 
                                           th:data-book-id="${item.book.bookId}"
                                           min="1" 
                                           th:max="${item.book.stock}"
                                           class="cart-quantity-input"
                                           onchange="updateCartItem(this)"
                                           style="width: 60px; text-align: center;"/>
                                </td>
                                <td class="product-subtotal">
                                    <span class="amount" th:text="|$${#numbers.formatDecimal(item.getSubtotal(), 1, 2)}|">$0.00</span>
                                </td>
                                <td class="product-remove">
                                    <a href="#" th:onclick="'removeFromCart(' + ${item.book.bookId} + '); return false;'" title="Remove">
                                        <i class="fa fa-times"></i>
                                    </a>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </form>
            </div>
        </div>
        <div class="row" th:if="${cartItems != null && !cartItems.isEmpty()}">
            <div class="col-lg-8 col-md-6 col-12">
                <div class="buttons-cart mb-30">
                    <ul>
                        <li><a th:href="@{/shop}">Continue Shopping</a></li>
                        <li><a href="#" onclick="clearCart(); return false;">Clear Cart</a></li>
                    </ul>
                </div>
                <!-- Coupon section -->
                <div class="coupon mb-30" th:if="${cartItems != null && !cartItems.isEmpty()}">
                    <h3>Coupon</h3>
                    <p>Enter your coupon code if you have one.</p>
                    <div th:if="${couponCode == null || couponCode.isEmpty()}">
                        <form id="coupon-form" onsubmit="applyCoupon(event); return false;">
                            <input type="text" 
                                   id="coupon-code-input" 
                                   placeholder="Coupon code" 
                                   required
                                   style="padding: 8px; width: 200px; margin-right: 10px;">
                            <button type="submit" 
                                    style="padding: 8px 20px; background: #333; color: #fff; border: none; cursor: pointer;">
                                Apply Coupon
                            </button>
                    </form>
                        <div id="coupon-message" style="margin-top: 10px; color: #d32f2f; display: none;"></div>
                    </div>
                    <div th:if="${couponCode != null && !couponCode.isEmpty()}" style="padding: 15px; background: #f5f5f5; border-radius: 4px;">
                        <p style="margin: 0 0 10px 0;">
                            <strong>Applied Coupon:</strong> 
                            <span th:text="${couponCode}">COUPON</span>
                            <a href="#" th:onclick="'removeCoupon(); return false;'" 
                               style="margin-left: 10px; color: #d32f2f; text-decoration: none;">
                                Remove
                            </a>
                        </p>
                        <p th:if="${couponDescription != null}" 
                           style="margin: 0; color: #666; font-size: 0.9em;" 
                           th:text="${couponDescription}">
                            Coupon description
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6 col-12">
                <div class="cart_totals">
                    <h2>Cart Totals</h2>
                    <table>
                        <tbody>
                        <tr class="cart-subtotal">
                            <th>Subtotal</th>
                            <td>
                                <span class="amount" th:text="|$${#numbers.formatDecimal(cartTotal != null ? cartTotal : 0, 1, 2)}|">$0.00</span>
                            </td>
                        </tr>
                        <tr th:if="${cartSavings != null && cartSavings > 0}" class="cart-savings" style="color: #28a745;">
                            <th>Savings (from discounts)</th>
                            <td>
                                <span class="amount" th:text="|$${#numbers.formatDecimal(cartSavings, 1, 2)}|">$0.00</span>
                            </td>
                        </tr>
                        <tr th:if="${couponDiscount != null && couponDiscount > 0}" class="cart-coupon-discount" style="color: #1976d2;">
                            <th>Coupon Discount</th>
                            <td>
                                <span class="amount" id="coupon-discount" th:text="|$${#numbers.formatDecimal(couponDiscount, 1, 2)}|">$0.00</span>
                            </td>
                        </tr>
                        <tr class="order-total">
                            <th>Total</th>
                            <td>
                                <strong>
                                    <span class="amount" id="cart-total" 
                                          th:text="${couponDiscount != null && couponDiscount > 0 ? 
                                                    ('$' + #numbers.formatDecimal(cartTotalAfterCoupon != null ? cartTotalAfterCoupon : cartTotal, 1, 2)) : 
                                                    ('$' + #numbers.formatDecimal(cartTotal != null ? cartTotal : 0, 1, 2))}">
                                        $0.00
                                    </span>
                                </strong>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="wc-proceed-to-checkout">
                        <a href="checkout.html">Proceed to Checkout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- cart-main-area-end -->
<!-- footer-area-start -->
<div th:replace="common/user/footer :: footer"></div>
<!-- footer-area-end -->


<!-- all js here -->
<div th:replace="common/user/js :: js"></div>

<!-- Cart JavaScript -->
<script>
    // Cập nhật quantity của sách trong cart
    function updateCartItem(input) {
        const bookId = input.getAttribute('data-book-id');
        const quantity = parseInt(input.value);
        
        // Nếu quantity <= 0, xóa item khỏi cart (không cần confirm)
        if (quantity <= 0) {
            removeFromCart(bookId);
            return;
        }
        
        fetch('/cart/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'bookId=' + bookId + '&quantity=' + quantity
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Cập nhật subtotal của item
                const row = input.closest('tr');
                const subtotalCell = row.querySelector('.product-subtotal .amount');
                if (subtotalCell && data.itemSubtotal !== undefined) {
                    subtotalCell.textContent = '$' + data.itemSubtotal.toFixed(2);
                }
                
                // Cập nhật cart total
                const cartTotalElement = document.getElementById('cart-total');
                if (cartTotalElement && data.cartTotal !== undefined) {
                    cartTotalElement.textContent = '$' + data.cartTotal.toFixed(2);
                }
                
                // Cập nhật cart info trong header
                updateCartInfo();
                
                // Cập nhật subtotal trong cart totals
                const subtotalElement = document.querySelector('.cart-subtotal .amount');
                if (subtotalElement && data.cartTotal !== undefined) {
                    subtotalElement.textContent = '$' + data.cartTotal.toFixed(2);
                }
            } else {
                console.error('Failed to update cart:', data.message);
                // Khôi phục giá trị cũ
                input.value = input.defaultValue || 1;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            // Khôi phục giá trị cũ
            input.value = input.defaultValue || 1;
        });
    }
    
    // Xóa tất cả items trong cart
    function clearCart() {
        if (!confirm('Clear all items from cart?')) {
            return;
        }
        
        fetch('/cart/clear', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Reload trang
                window.location.reload();
            } else {
                console.error('Failed to clear cart:', data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    
    // Lưu giá trị mặc định của input khi trang load
    document.addEventListener('DOMContentLoaded', function() {
        const quantityInputs = document.querySelectorAll('.cart-quantity-input');
        quantityInputs.forEach(input => {
            input.defaultValue = input.value;
        });
    });
    
    // Apply coupon
    function applyCoupon(event) {
        event.preventDefault();
        
        const couponCode = document.getElementById('coupon-code-input').value.trim();
        const messageDiv = document.getElementById('coupon-message');
        
        if (!couponCode) {
            messageDiv.textContent = 'Please enter a coupon code';
            messageDiv.style.display = 'block';
            messageDiv.style.color = '#d32f2f';
            return;
        }
        
        fetch('/cart/apply-coupon', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'couponCode=' + encodeURIComponent(couponCode)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Reload trang để hiển thị coupon đã áp dụng
                window.location.reload();
            } else {
                messageDiv.textContent = data.message || 'Failed to apply coupon';
                messageDiv.style.display = 'block';
                messageDiv.style.color = '#d32f2f';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            messageDiv.textContent = 'An error occurred. Please try again.';
            messageDiv.style.display = 'block';
            messageDiv.style.color = '#d32f2f';
        });
    }
    
    // Remove coupon
    function removeCoupon() {
        fetch('/cart/remove-coupon', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Reload trang để cập nhật giá
                window.location.reload();
            } else {
                console.error('Failed to remove coupon:', data.message);
                showToast(data.message || 'Failed to remove coupon', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showToast('An error occurred. Please try again.', 'error');
        });
    }
</script>
</body>

<!-- Mirrored from htmldemo.net/koparion/koparion/cart.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 03 Nov 2025 15:14:39 GMT -->
</html>
